# Greatest Works - åˆ†å¸ƒå¼MMOæ¸¸æˆæœåŠ¡å™¨

> English version: see [README.en.md](README.en.md)

åŸºäºGoè¯­è¨€å’Œé¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)æ¶æ„å¼€å‘çš„åˆ†å¸ƒå¼å¤§å‹å¤šäººåœ¨çº¿æ¸¸æˆæœåŠ¡å™¨ï¼Œé‡‡ç”¨ç°ä»£åŒ–å¾®æœåŠ¡è®¾è®¡ï¼Œæ”¯æŒé«˜å¹¶å‘å’Œåˆ†å¸ƒå¼éƒ¨ç½²ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„åˆ†å¸ƒå¼MMOæ¸¸æˆæœåŠ¡å™¨é¡¹ç›®ï¼Œé‡‡ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡(Domain-Driven Design)æ¶æ„æ¨¡å¼ï¼Œæä¾›é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€æ˜“ç»´æŠ¤çš„æ¸¸æˆæœåŠ¡å™¨è§£å†³æ–¹æ¡ˆã€‚é¡¹ç›®é‡‡ç”¨åˆ†å¸ƒå¼å¤šèŠ‚ç‚¹æ¶æ„ï¼Œæ”¯æŒç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•ã€‚

### ğŸ† é¡¹ç›®äº®ç‚¹

- **âœ… ç¼–è¯‘é€šè¿‡**: æ‰€æœ‰ä»£ç å·²ä¿®å¤ç¼–è¯‘é”™è¯¯ï¼Œé¡¹ç›®å¯æ­£å¸¸æ„å»º
- **ğŸ—ï¸ DDDæ¶æ„**: å®Œæ•´çš„é¢†åŸŸé©±åŠ¨è®¾è®¡å®ç°
- **ğŸŒ åˆ†å¸ƒå¼**: å¤šæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- **ğŸ”§ å¾®æœåŠ¡**: è®¤è¯ã€ç½‘å…³ã€æ¸¸æˆæœåŠ¡åˆ†ç¦»
- **ğŸ“Š ç›‘æ§**: å®Œæ•´çš„æ—¥å¿—å’Œç›‘æ§ä½“ç³»
- **ğŸ³ å®¹å™¨åŒ–**: Dockerå’ŒKubernetesæ”¯æŒ

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ—ï¸ **DDDæ¶æ„**: é‡‡ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œæ¸…æ™°çš„æ¶æ„åˆ†å±‚å’ŒèŒè´£åˆ†ç¦»
- ğŸŒ **åˆ†å¸ƒå¼è®¾è®¡**: å¤šèŠ‚ç‚¹ç‹¬ç«‹éƒ¨ç½²ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- ğŸš€ **é«˜æ€§èƒ½ç½‘ç»œ**: åŸºäºGoåŸç”ŸRPC + TCP + HTTPå¤šåè®®æ”¯æŒ
- ğŸ”§ **å¾®æœåŠ¡æ¶æ„**: è®¤è¯æœåŠ¡ã€ç½‘å…³æœåŠ¡ã€æ¸¸æˆæœåŠ¡ç‹¬ç«‹éƒ¨ç½²
- ğŸ’¾ **å¤šæ•°æ®åº“æ”¯æŒ**: MongoDB + Redis æ··åˆå­˜å‚¨ç­–ç•¥
- ğŸ” **å®‰å…¨è®¤è¯**: JWTè®¤è¯ç³»ç»Ÿï¼Œä¿éšœç”¨æˆ·æ•°æ®å®‰å…¨
- ğŸ® **å®Œæ•´æ¸¸æˆåŠŸèƒ½**: æ¶µç›–ç°ä»£MMOæ¸¸æˆçš„æ ¸å¿ƒç³»ç»Ÿ
- ğŸ“Š **å®æ—¶åŒæ­¥**: é«˜é¢‘ç‡çš„æ¸¸æˆçŠ¶æ€åŒæ­¥å’Œäº‹ä»¶å¤„ç†
- ğŸ›¡ï¸ **å®¹é”™è®¾è®¡**: å®Œå–„çš„é”™è¯¯å¤„ç†ã€ç›‘æ§å’Œæ¢å¤æœºåˆ¶
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²**: Dockerå’ŒKubernetesæ”¯æŒ
- ğŸ“š **å®Œæ•´æ–‡æ¡£**: è¯¦ç»†çš„APIæ–‡æ¡£å’Œæ¶æ„è¯´æ˜

## ğŸ—ï¸ åˆ†å¸ƒå¼æ¶æ„è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨åˆ†å¸ƒå¼å¤šèŠ‚ç‚¹æ¶æ„ï¼Œå°†æ¸¸æˆæœåŠ¡å™¨æ‹†åˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„æœåŠ¡èŠ‚ç‚¹ï¼š

### æœåŠ¡èŠ‚ç‚¹

#### ğŸ” è®¤è¯æœåŠ¡ (Auth Service)
- **åè®®**: HTTP
- **ç«¯å£**: 8080
- **èŒè´£**: ç”¨æˆ·è®¤è¯ã€æˆæƒã€ä¼šè¯ç®¡ç†
- **åŠŸèƒ½**: ç™»å½•ã€æ³¨å†Œã€ä»¤ç‰Œç®¡ç†ã€æƒé™æ§åˆ¶

#### ğŸŒ ç½‘å…³æœåŠ¡ (Gateway Service)  
- **åè®®**: TCP
- **ç«¯å£**: 9090
- **èŒè´£**: å®¢æˆ·ç«¯è¿æ¥ç®¡ç†ã€åè®®è½¬æ¢ã€è´Ÿè½½å‡è¡¡
- **åŠŸèƒ½**: è¿æ¥ç®¡ç†ã€æ¶ˆæ¯è·¯ç”±ã€åè®®è½¬æ¢

#### ğŸ® æ¸¸æˆæœåŠ¡ (Game Service)
- **åè®®**: GoåŸç”ŸRPC
- **ç«¯å£**: 8081
- **èŒè´£**: æ ¸å¿ƒæ¸¸æˆé€»è¾‘ã€é¢†åŸŸæ¨¡å‹ã€ä¸šåŠ¡è§„åˆ™
- **åŠŸèƒ½**: ç©å®¶ç®¡ç†ã€æˆ˜æ–—ç³»ç»Ÿã€æ’è¡Œæ¦œã€ç¤¾äº¤ç³»ç»Ÿ

### é€šä¿¡åè®®

```mermaid
flowchart LR
    subgraph Client[å®¢æˆ·ç«¯]
      C1[æ¸¸æˆå®¢æˆ·ç«¯]
    end

    subgraph Auth[è®¤è¯æœåŠ¡\nHTTP:8080]
      A1[REST API]
    end

    subgraph Gateway[ç½‘å…³æœåŠ¡\nTCP:9090]
      G1[è¿æ¥ç®¡ç†]
      G2[æ¶ˆæ¯è·¯ç”±]
    end

    subgraph Game[æ¸¸æˆæœåŠ¡\nGo RPC:8081]
      S1[ç©æ³•é€»è¾‘]
      S2[é¢†åŸŸæ¨¡å‹]
    end

    subgraph Data[æ•°æ®ä¸æ¶ˆæ¯]
      M[(MongoDB)]
      R[(Redis)]
      N[(NATS)]
    end

    C1 -- HTTP --> A1
    C1 -- TCP --> G1
    G1 -- RPC --> S1
    S1 <-- RPC --> G2
    S1 --> M
    S1 --> R
    S1 -.äº‹ä»¶å‘å¸ƒ.-> N
    G1 --> R
```

- **å®¢æˆ·ç«¯ â†” è®¤è¯æœåŠ¡**: HTTP (RESTful API) - ç”¨æˆ·è®¤è¯ã€æ³¨å†Œã€ç™»å½•
- **å®¢æˆ·ç«¯ â†” ç½‘å…³æœåŠ¡**: TCP (æ¸¸æˆåè®®) - æ¸¸æˆæ•°æ®äº¤äº’
- **ç½‘å…³æœåŠ¡ â†” æ¸¸æˆæœåŠ¡**: GoåŸç”ŸRPC (å†…éƒ¨é€šä¿¡) - æ¸¸æˆé€»è¾‘å¤„ç†
- **è®¤è¯æœåŠ¡ â†” æ¸¸æˆæœåŠ¡**: GoåŸç”ŸRPC (æœåŠ¡é—´é€šä¿¡) - ç”¨æˆ·çŠ¶æ€åŒæ­¥
- **å®¢æˆ·ç«¯ä¸ç›´æ¥ä¸æ¸¸æˆæœåŠ¡é€šä¿¡**: æ‰€æœ‰æ¸¸æˆæ•°æ®é€šè¿‡ç½‘å…³æœåŠ¡è½¬å‘

## ğŸ§ª é›†æˆæµ‹è¯•ä¸å‹æµ‹æ¨¡æ‹Ÿå®¢æˆ·ç«¯

é¡¹ç›®æä¾›äº†ä½äº `tools/simclient` çš„æ¨¡æ‹Ÿå®¢æˆ·ç«¯ï¼Œå¯ç”¨äºç«¯åˆ°ç«¯é›†æˆæµ‹è¯•ä¸å‹æµ‹å®éªŒã€‚

### å¿«é€Ÿä½“éªŒ

```powershell
go run ./tools/simclient/cmd/simclient -mode integration
```

é»˜è®¤ä¼šè·³è¿‡è®¤è¯æœåŠ¡å¹¶è¿æ¥ç½‘å…³å‘é€åŸºç¡€å¿ƒè·³ä¸ç§»åŠ¨æŠ¥æ–‡ã€‚è‹¥éœ€å¯ç”¨è®¤è¯æˆ–è‡ªå®šä¹‰å‚æ•°ï¼Œå¯æŒ‡å®šé…ç½®æ–‡ä»¶ï¼š

```powershell
go run ./tools/simclient/cmd/simclient -mode integration -config tools/simclient/config.example.yaml
```

### E2E åœºæ™¯ï¼ˆç«¯åˆ°ç«¯æµç¨‹ï¼‰

å·²å†…ç½®å®Œæ•´çš„ E2E åœºæ™¯ä¸ç¤ºä¾‹é…ç½®ï¼Œè¦†ç›–â€œè®¤è¯â†’è¿æ¥â†’ç™»å½•â†’ç§»åŠ¨â†’æ–½æ³•â†’ç™»å‡ºâ€çš„å®Œæ•´é“¾è·¯ï¼š

```powershell
# è¿è¡Œå•æ¬¡ç«¯åˆ°ç«¯åœºæ™¯ï¼ˆé›†æˆéªŒè¯ï¼‰
go run ./tools/simclient/cmd/simclient -mode integration -config tools/simclient/e2e.yaml

# è¿è¡Œç«¯åˆ°ç«¯å‹æµ‹ï¼ˆå¹¶å‘å¤šç”¨æˆ·ï¼‰
go run ./tools/simclient/cmd/simclient -mode load -config tools/simclient/e2e_load.yaml

# å¯é€‰ï¼šå¿«é€Ÿå¼€å…³è®¤è¯æµç¨‹
# å¼ºåˆ¶å¯ç”¨è®¤è¯
go run ./tools/simclient/cmd/simclient -mode integration -config tools/simclient/e2e.yaml -auth
# å¼ºåˆ¶è·³è¿‡è®¤è¯
go run ./tools/simclient/cmd/simclient -mode integration -config tools/simclient/e2e.yaml -no-auth
```

è¯´æ˜ä¸é«˜çº§ç”¨æ³•è¯·å‚é˜… `tools/simclient/README_E2E.md`ï¼ŒåŒ…å«ï¼šæŠ¥æ–‡å¤´+JSONè½½è·å°è£…ã€åŠ¨ä½œæ—¶åºã€é”™è¯¯æ’æŸ¥ã€æŒ‡æ ‡è¾“å‡ºç­‰ã€‚

#### E2E äº¤äº’æ—¶åºï¼ˆæ¦‚è§ˆï¼‰

```mermaid
sequenceDiagram
  participant SC as SimClient
  participant AUTH as è®¤è¯æœåŠ¡
  participant GW as ç½‘å…³æœåŠ¡
  participant GS as æ¸¸æˆæœåŠ¡

  Note over SC: å¯é€‰ï¼šè®¤è¯
  SC->>AUTH: POST /api/v1/auth/login
  AUTH-->>SC: 200 OK (token)

  SC->>GW: TCP Connect
  GW-->>SC: Conn Ack
  SC->>GW: MsgPlayerLogin(token|player)
  GW->>GS: RPC Login
  GS-->>GW: LoginOK(pos,map)
  GW-->>SC: LoginOK(pos,map)

  SC->>GW: MsgPlayerMove(x,y,z)
  GW->>GS: RPC Move
  GS-->>GW: MoveOK
  GW-->>SC: MoveOK
  GW-->>Clients: AOI å¹¿æ’­

  SC->>GW: MsgBattleSkill(skill_id,target)
  GW->>GS: RPC CastSkill
  GS-->>GW: Result{damage,crit}
  GW-->>SC: SkillResult
  GW-->>Clients: AOI å¹¿æ’­

  SC->>GW: MsgPlayerLogout
  GW->>GS: RPC Logout + æŒä¹…åŒ–ä½ç½®
  GS-->>GW: LogoutOK
  GW-->>SC: LogoutOK
```

### å‹æµ‹æ¨¡å¼

```powershell
go run ./tools/simclient/cmd/simclient -mode load -config tools/simclient/config.example.yaml -users 200 -concurrency 50
```

å‹æµ‹æ¨¡å¼ä¼šæŒ‰é…ç½®å¹¶å‘å¯åŠ¨è™šæ‹Ÿç©å®¶ï¼Œè¾“å‡ºå„åŠ¨ä½œçš„æœ€å°å€¼ã€å¹³å‡å€¼ã€P95 ä¸æœ€å¤§è€—æ—¶ï¼Œå¹¶è®°å½•å¤±è´¥æ ·ä¾‹ã€‚

### é›†æˆæµ‹è¯•

åœ¨æœåŠ¡è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¼€å¯æ¨¡æ‹Ÿå®¢æˆ·ç«¯çš„å†’çƒŸæµ‹è¯•ï¼š

```powershell
$Env:SIMCLIENT_E2E="1"; go test ./tools/simclient -run TestBasicScenarioSmoke -count=1
```

æœªè®¾ç½®ç¯å¢ƒå˜é‡æ—¶ï¼Œæµ‹è¯•ä¼šè‡ªåŠ¨è·³è¿‡ï¼Œé¿å…åœ¨æœªéƒ¨ç½²ä¾èµ–æœåŠ¡æ—¶è¯¯æŠ¥å¤±è´¥ã€‚

### åŠŸèƒ½çº§åœºæ™¯ï¼ˆç‹¬ç«‹åŠŸèƒ½éªŒè¯ï¼‰

æ¨¡æ‹Ÿå®¢æˆ·ç«¯ç°åœ¨æ”¯æŒåŸºäºåŠŸèƒ½åº“çš„å¯é…ç½®åœºæ™¯ï¼Œä¾¿äºå¯¹å•ä¸ªç³»ç»Ÿï¼ˆå¦‚ç©å®¶ã€æˆ˜æ–—ã€å® ç‰©ç­‰ï¼‰è¿›è¡Œç‹¬ç«‹éªŒè¯ã€‚é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­å°† `scenario.type` è®¾ä¸º `feature`ï¼Œå³å¯æŒ‰åŠŸèƒ½æ¸…å•é©±åŠ¨æ¶ˆæ¯åºåˆ—ï¼š

```yaml
scenario:
  name: "pet-feature-check"
  type: "feature"          # å¯é€‰ï¼šbasicï¼ˆé»˜è®¤ï¼‰æˆ– feature
  features:                 # å¤ç”¨å†…ç½®åŠŸèƒ½åº“ï¼ˆè¯¦è§ tools/simclient/feature_library.goï¼‰
    - "player.basic"
    - "pet.basic"
  actions:                  # ä¹Ÿå¯è¿½åŠ è‡ªå®šä¹‰åŠ¨ä½œ
    - name: "quest.accept"
      message: "quest.accept"
      expect_response: true
      pause: "2s"
```

å¸¸ç”¨åŠŸèƒ½æ ‡è¯†åŒ…æ‹¬ `player.login`ã€`battle.basic`ã€`pet.summon`ã€`building.status` ç­‰ã€‚æ¯ä¸ªåŠŸèƒ½ä¼šè‡ªåŠ¨æ˜ å°„åˆ°å¯¹åº”çš„ç½‘å…³æ¶ˆæ¯å¹¶è®°å½•å“åº”æ—¶é—´ã€‚è‹¥ä»…é…ç½® `scenario.type` è€Œçœç•¥ `features`ï¼Œç¨‹åºä¼šå°è¯•åŒ¹é…å†…ç½®åŠŸèƒ½ï¼›ä¹Ÿå¯ä»¥å®Œå…¨ä½¿ç”¨ `actions` å­—æ®µè‡ªå®šä¹‰æŠ¥æ–‡åºåˆ—ï¼Œæ”¯æŒè®¾ç½® `flags`ã€`repeat`ã€`pause` ç­‰å‚æ•°ï¼Œå®ç°æ›´ç²¾ç»†çš„éªŒè¯è„šæœ¬ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
greatestworks/
â”œâ”€â”€ cmd/                        # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ auth-service/           # è®¤è¯æœåŠ¡ (HTTP:8080)
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ gateway-service/        # ç½‘å…³æœåŠ¡ (TCP:9090)
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ game-service/           # æ¸¸æˆæœåŠ¡ (RPC:8081)
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ configs/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ auth-service.yaml       # è®¤è¯æœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ gateway-service.yaml    # ç½‘å…³æœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ game-service.yaml       # æ¸¸æˆæœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ docker.yaml            # Dockerç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ config.*.yaml          # ç¯å¢ƒé…ç½®æ¨¡æ¿
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”‚   â””â”€â”€ diagrams/              # æ¶æ„å›¾è¡¨
â”‚       â”œâ”€â”€ module.drawio      # æ¨¡å—å…³ç³»å›¾
â”‚       â”œâ”€â”€ svr.frame.drawio   # æœåŠ¡å™¨æ¶æ„å›¾
â”‚       â””â”€â”€ uml.drawio         # UMLç±»å›¾
â”œâ”€â”€ internal/                   # å†…éƒ¨æ¨¡å— (DDDæ¶æ„)
â”‚   â”œâ”€â”€ application/           # åº”ç”¨å±‚ (CQRS + æœåŠ¡ç¼–æ’)
â”‚   â”‚   â”œâ”€â”€ commands/          # å‘½ä»¤å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ handlers/          # å‘½ä»¤/æŸ¥è¯¢æ€»çº¿å®ç°
â”‚   â”‚   â”œâ”€â”€ interfaces/        # åº”ç”¨å±‚æ¥å£å¥‘çº¦
â”‚   â”‚   â”œâ”€â”€ queries/           # æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ services/          # åº”ç”¨æœåŠ¡ä¸ service_registry
â”‚   â”œâ”€â”€ domain/                # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ player/           # ç©å®¶é¢†åŸŸ
â”‚   â”‚   â”‚   â”œâ”€â”€ beginner/     # æ–°æ‰‹å¼•å¯¼
â”‚   â”‚   â”‚   â”œâ”€â”€ hangup/       # æŒ‚æœºç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ honor/        # è£èª‰ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ player.go     # ç©å®¶èšåˆæ ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ service.go    # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ repository.go # ä»“å‚¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ battle/           # æˆ˜æ–—é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ social/           # ç¤¾äº¤é¢†åŸŸ (31ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ building/         # å»ºç­‘é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ pet/              # å® ç‰©é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ ranking/          # æ’è¡Œæ¦œé¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ minigame/         # å°æ¸¸æˆé¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ npc/              # NPCé¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ quest/            # ä»»åŠ¡é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ scene/            # åœºæ™¯é¢†åŸŸ (24ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ skill/            # æŠ€èƒ½é¢†åŸŸ
â”‚   â”‚   â”œâ”€â”€ inventory/        # èƒŒåŒ…é¢†åŸŸ
â”‚   â”‚   â”‚   â”œâ”€â”€ dressup/      # è£…æ‰®ç³»ç»Ÿ
â”‚   â”‚   â”‚   â””â”€â”€ synthesis/    # åˆæˆç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ events/           # é¢†åŸŸäº‹ä»¶
â”‚   â”œâ”€â”€ infrastructure/        # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ persistence/      # æ•°æ®æŒä¹…åŒ– (10ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”‚   â”œâ”€â”€ base_repository.go    # åŸºç¡€ä»“å‚¨
â”‚   â”‚   â”‚   â”œâ”€â”€ player_repository.go  # ç©å®¶ä»“å‚¨
â”‚   â”‚   â”‚   â”œâ”€â”€ battle_repository.go  # æˆ˜æ–—ä»“å‚¨
â”‚   â”‚   â”‚   â”œâ”€â”€ hangup_repository.go # æŒ‚æœºä»“å‚¨
â”‚   â”‚   â”‚   â”œâ”€â”€ weather_repository.go # å¤©æ°”ä»“å‚¨
â”‚   â”‚   â”‚   â”œâ”€â”€ plant_repository.go   # æ¤ç‰©ä»“å‚¨
â”‚   â”‚   â”‚   â””â”€â”€ npc_repository.go     # NPCä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ cache/            # ç¼“å­˜æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ messaging/        # æ¶ˆæ¯æœåŠ¡ (5ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”‚   â”œâ”€â”€ nats_publisher.go    # NATSå‘å¸ƒè€…
â”‚   â”‚   â”‚   â”œâ”€â”€ nats_subscriber.go   # NATSè®¢é˜…è€…
â”‚   â”‚   â”‚   â”œâ”€â”€ event_dispatcher.go  # äº‹ä»¶åˆ†å‘å™¨
â”‚   â”‚   â”‚   â””â”€â”€ worker_pool.go       # å·¥ä½œæ± 
â”‚   â”‚   â”œâ”€â”€ network/          # ç½‘ç»œæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç† (7ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ logging/          # æ—¥å¿—æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ auth/            # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ container/       # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚   â”‚   â””â”€â”€ monitoring/      # ç›‘æ§æœåŠ¡
â”‚   â”œâ”€â”€ interfaces/            # æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ http/             # HTTPæ¥å£ (13ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/         # è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ gm/           # GMç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ server.go     # HTTPæœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ tcp/              # TCPæ¥å£ (14ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/     # TCPå¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ connection/   # è¿æ¥ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ protocol/     # åè®®å®šä¹‰
â”‚   â”‚   â””â”€â”€ rpc/              # RPCæ¥å£ (4ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ events/               # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ eventbus.go       # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”œâ”€â”€ middleware.go      # äº‹ä»¶ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ worker.go         # äº‹ä»¶å·¥ä½œå™¨
â”‚   â”œâ”€â”€ errors/               # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ domain_errors.go # é¢†åŸŸé”™è¯¯
â”‚   â”œâ”€â”€ proto/                # åè®®å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ battle/           # æˆ˜æ–—åè®®
â”‚   â”‚   â”œâ”€â”€ player/           # ç©å®¶åè®®
â”‚   â”‚   â””â”€â”€ common/           # é€šç”¨åè®®
â”‚   â””â”€â”€ readme.md             # å†…éƒ¨æ¨¡å—è¯´æ˜
â”œâ”€â”€ proto/                     # Protocol Bufferså®šä¹‰
â”‚   â”œâ”€â”€ battle.proto          # æˆ˜æ–—åè®®
â”‚   â”œâ”€â”€ player.proto          # ç©å®¶åè®®
â”‚   â”œâ”€â”€ pet.proto             # å® ç‰©åè®®
â”‚   â””â”€â”€ common.proto          # é€šç”¨åè®®
â”œâ”€â”€ scripts/                   # å¼€å‘è„šæœ¬
â”‚   â”œâ”€â”€ start-services.bat    # Windowså¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start-services.sh     # Linux/Macå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ build.sh              # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh             # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ generate_proto.sh     # åè®®ç”Ÿæˆè„šæœ¬
â”‚   â””â”€â”€ setup-dev.sh          # å¼€å‘ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ docker-compose.yml         # Dockerç¼–æ’
â”œâ”€â”€ Dockerfile                 # Dockeré•œåƒ
â”œâ”€â”€ Makefile                   # æ„å»ºå·¥å…·
â”œâ”€â”€ go.mod                     # Goæ¨¡å—å®šä¹‰
â”œâ”€â”€ go.work                    # Goå·¥ä½œç©ºé—´
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯
- **è¯­è¨€**: Go 1.24+
- **æ¶æ„æ¨¡å¼**: é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD) + åˆ†å¸ƒå¼æ¶æ„
- **ç½‘ç»œåè®®**: HTTP + TCP + GoåŸç”ŸRPC
- **æ•°æ®åº“**: MongoDB (ä¸»æ•°æ®åº“) + Redis (ç¼“å­˜)
- **æ¶ˆæ¯é˜Ÿåˆ—**: NATS (å¯é€‰)
- **è®¤è¯**: JWT + è‡ªå®šä¹‰è®¤è¯
- **æœåŠ¡å‘ç°**: æ”¯æŒConsulã€Etcdç­‰

### å¼€å‘å·¥å…·
- **æ„å»ºå·¥å…·**: Make + Go Modules
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ç¼–æ’**: Kubernetes
- **ä»£ç è´¨é‡**: golangci-lint + è‡ªå®šä¹‰è§„èŒƒ
- **æ–‡æ¡£**: Markdown + æ¶æ„å›¾

### ç›‘æ§ä¸è¿ç»´
- **æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿— + åˆ†çº§è¾“å‡º
- **ç›‘æ§**: è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†ï¼ˆPrometheus å·²ç§»é™¤ï¼Œä¿ç•™é…ç½®é¡¹ä»…ä¸ºå…¼å®¹ï¼‰
- **æ€§èƒ½å‰–æ**: å†…ç½® `pprof` HTTP ç«¯ç‚¹ï¼Œå¯æŒ‰æœåŠ¡ç‹¬ç«‹å¼€å¯/å…³é—­
- **å¥åº·æ£€æŸ¥**: HTTPå¥åº·æ£€æŸ¥æ¥å£
- **é…ç½®ç®¡ç†**: YAMLé…ç½® + ç¯å¢ƒå˜é‡

#### ğŸ” æ€§èƒ½å‰–æ (pprof)
- é€šè¿‡ `monitoring.profiling` é…ç½®å—å¯ç”¨ï¼Œé»˜è®¤ `host=0.0.0.0`ï¼Œå¯ç”¨æ—¶è‹¥æœªæŒ‡å®šç«¯å£åˆ™ä¸º `6060`ã€‚
- ç¤ºä¾‹é…ç½®ï¼š

  ```yaml
  monitoring:
    profiling:
      enabled: true
      host: "0.0.0.0"
      port: 6061
  ```

- é»˜è®¤ç¤ºä¾‹ç«¯å£ï¼šæ¸¸æˆæœåŠ¡ `6060`ã€è®¤è¯æœåŠ¡ `6061`ã€ç½‘å…³æœåŠ¡ `6062`ï¼ˆå¯æŒ‰éœ€è°ƒæ•´ï¼‰ã€‚
- è®¿é—®æ–¹å¼ï¼š`http://<host>:<port>/debug/pprof/`ï¼ˆæ”¯æŒ `profile`, `heap`, `goroutine` ç­‰å­è·¯å¾„ï¼‰ã€‚
- å®‰å…¨å»ºè®®ï¼šä»…åœ¨å—ä¿¡ä»»ç½‘ç»œå†…å¼€æ”¾æˆ–é€šè¿‡é˜²ç«å¢™/åå‘ä»£ç†é™åˆ¶è®¿é—®ï¼›ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»“åˆ mTLS æˆ–å†…ç½‘éš§é“ã€‚
- Go åŸç”Ÿå·¥å…·é“¾æ”¯æŒç›´æ¥é‡‡æ ·ï¼Œä¾‹å¦‚ï¼š

  ```bash
  go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30
  ```

- å¸¸ç”¨å­è·¯å¾„ä¸€è§ˆï¼š

  | è·¯å¾„ | æ•°æ®ç±»å‹ | å…¸å‹ç”¨é€” |
  | --- | --- | --- |
  | `/debug/pprof/profile` | CPU é‡‡æ · (é»˜è®¤ 30s) | åˆ†æçƒ­ç‚¹å‡½æ•°ã€CPU ä½¿ç”¨ç‡ |
  | `/debug/pprof/heap` | å †å†…å­˜å¿«ç…§ | æ’æŸ¥å†…å­˜å ç”¨ä¸æ³„æ¼ |
  | `/debug/pprof/goroutine` | Goroutine å †æ ˆ | å®šä½æ­»é”ã€é˜»å¡ã€åç¨‹æ³„æ¼ |
  | `/debug/pprof/block` | é˜»å¡ / äº’æ–¥ç­‰å¾… | æŸ¥çœ‹é”ç«äº‰ã€IO é˜»å¡ï¼ˆå«ç½‘ç»œç­‰å¾…ï¼‰ |
  | `/debug/pprof/mutex` | äº’æ–¥é”äº‰ç”¨ | è¯†åˆ«é”çƒ­ç‚¹ |
  | `/debug/pprof/threadcreate` | çº¿ç¨‹åˆ›å»º | è§‚å¯Ÿç³»ç»Ÿçº¿ç¨‹å¢é‡ |
  | `/debug/pprof/trace` | å…¨å±€æ‰§è¡Œè½¨è¿¹ | æ•è·è°ƒåº¦ã€GCã€ç½‘ç»œäº‹ä»¶ï¼Œç”Ÿæˆ `.trace` æ–‡ä»¶ |

- é‡‡é›†è·Ÿè¸ª (å«ç½‘ç»œäº‹ä»¶) ç¤ºä¾‹ï¼š

  ```bash
  go tool trace -http=:0 http://localhost:6060/debug/pprof/trace?seconds=5
  ```

  æ‰“å¼€æµè§ˆå™¨åå¯æŸ¥çœ‹ç½‘ç»œ/ç³»ç»Ÿè°ƒç”¨é˜»å¡ã€åç¨‹è°ƒåº¦ç­‰ç»†èŠ‚ã€‚

#### ğŸ§ª Profiling å¿«é€Ÿå…¥é—¨

1. **å¯ç”¨é…ç½®**ï¼šåœ¨ç›®æ ‡æœåŠ¡çš„é…ç½®æ–‡ä»¶ä¸­ç¡®ä¿ `monitoring.profiling.enabled: true`ï¼Œå¹¶ç¡®è®¤ç«¯å£æœªè¢«å ç”¨ã€‚
2. **å¯åŠ¨æœåŠ¡**ï¼šé€šè¿‡ `make run-<service>`ã€`docker-compose up` æˆ–è‡ªå®šä¹‰è„šæœ¬å¯åŠ¨å¯¹åº”è¿›ç¨‹ã€‚
3. **é‡‡é›†å¿«ç…§**ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¿å­˜åŸå§‹æ•°æ®ä»¥ä¾¿ç¦»çº¿åˆ†æï¼š

  ```bash
  # CPU é‡‡æ · 60 ç§’åä¿å­˜ä¸º cpu.prof
  curl -o cpu.prof "http://localhost:6060/debug/pprof/profile?seconds=60"

  # å †å†…å­˜å¿«ç…§
  curl -o heap.prof "http://localhost:6060/debug/pprof/heap"

  # Goroutine æ ˆä¿¡æ¯
  curl -o goroutine.txt "http://localhost:6060/debug/pprof/goroutine?debug=1"
  ```

4. **å¯è§†åŒ–åˆ†æ**ï¼š

  ```bash
  # CLI åˆ†æçƒ­ç‚¹å‡½æ•°
  go tool pprof cpu.prof

  # å¯åŠ¨ Web UIï¼ˆä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼‰
  go tool pprof -http=:0 heap.prof
  ```

5. **é«˜çº§è·Ÿè¸ª**ï¼šé€šè¿‡ `go tool trace` åŠ è½½ç¬¬ 3 æ­¥ç”Ÿæˆçš„ `.trace` æ–‡ä»¶ï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ç½‘ç»œ/ç³»ç»Ÿè°ƒç”¨ã€åç¨‹è°ƒåº¦å’Œ GC æ—¶é—´çº¿ã€‚

> ç«¯å£é€ŸæŸ¥ï¼šæ¸¸æˆæœåŠ¡ `6060`ã€è®¤è¯æœåŠ¡ `6061`ã€ç½‘å…³æœåŠ¡ `6062`ï¼Œå¯æ ¹æ®éƒ¨ç½²ç¯å¢ƒåœ¨é…ç½®æ–‡ä»¶ä¸­è°ƒæ•´ã€‚


## ğŸ‰ æœ€æ–°æ›´æ–° (2025-10)

### âœ… æ ¸å¿ƒæ”¹è¿›

- **åº”ç”¨å±‚å†…èš**: å°†åŸ `application/*` ç›®å½•æ•´ä½“è¿ç§»è‡³ `internal/application`ï¼Œç»Ÿä¸€å¯¼å…¥è·¯å¾„å¹¶å¼•å…¥é›†ä¸­å¼ `service_registry`ã€‚
- **æ¥å£é€‚é…**: åŒæ­¥æ›´æ–° HTTP/TCP/RPC é€‚é…å±‚çš„ä¾èµ–è·¯å¾„ï¼Œä¿æŒå‘½ä»¤ä¸æŸ¥è¯¢æ€»çº¿çš„è¿è¡Œä¸€è‡´æ€§ã€‚
- **æ„å»ºå¯é æ€§**: å…¨é‡æ‰§è¡Œ `go fmt ./...` ä¸ `go test ./...`ï¼Œç¡®ä¿ä»£ç é£æ ¼ç»Ÿä¸€ä¸”æµ‹è¯•é€šè¿‡ã€‚

### âœ¨ æ–°å¢åŠŸèƒ½

- è§’è‰²ä½ç½®æŒä¹…åŒ–ï¼šç™»å½•è‡ªåŠ¨æ¢å¤ä¸Šæ¬¡åœ°å›¾ä¸åæ ‡ï¼Œç™»å‡º/æ–­çº¿å³æ—¶ä¿å­˜ã€‚
- æˆ˜æ–—ä¼¤å®³è®¡ç®—ä¸ç»“æœå¹¿æ’­ï¼šå®ç°åŸºç¡€ä¼¤å®³ä¸æš´å‡»ï¼ˆ10% æ¦‚ç‡ï¼Œ1.5x å€ç‡ï¼‰ï¼Œé€šè¿‡ AOI å°†ç»“æœå¹¿æ’­ç»™å¯è§å®ä½“ã€‚
- æ¨¡æ‹Ÿå®¢æˆ·ç«¯ E2E åœºæ™¯ï¼šæ–°å¢ `tools/simclient/e2e.yaml` ä¸ `tools/simclient/e2e_load.yaml`ï¼Œæ”¯æŒç«¯åˆ°ç«¯éªŒè¯ä¸å¹¶å‘å‹æµ‹ã€‚
- ä¾èµ–æé†’ï¼šç½‘å…³æœåŠ¡ç°éœ€è¿æ¥ MongoDB æ‰èƒ½å®Œæˆä½ç½®æŒä¹…åŒ–ï¼ˆæœ¬åœ°å¯é€šè¿‡ `docker-compose up -d` ä¸€é”®æ‹‰èµ·ä¾èµ–ï¼‰ã€‚

### ğŸ§¹ æŠ€æœ¯å€ºåŠ¡æ¸…ç†

- å½’æ¡£æ—§æœ‰çš„åº”ç”¨å±‚å…¥å£è¯´æ˜ï¼Œå°†æ–‡æ¡£ä¸ç°æœ‰ç›®å½•ç»“æ„ä¿æŒä¸€è‡´ã€‚
- è¡¥å……æœ€æ–°çš„å¯åŠ¨è„šæœ¬è¯´æ˜ï¼Œæ–¹ä¾¿åœ¨ Windows / Linux ç¯å¢ƒå¿«é€Ÿæ‹‰èµ·æœåŠ¡ã€‚
- æ¢³ç†æ–‡æ¡£é“¾æ¥ä¸ç¤ºä¾‹é…ç½®ï¼Œç§»é™¤å¤±æ•ˆè·¯å¾„ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç¯å¢ƒè¦æ±‚

- **Go**: 1.24 æˆ–æ›´é«˜ç‰ˆæœ¬
- **MongoDB**: 4.4+ (æ¨è 5.0+)
- **Redis**: 6.0+ (æ¨è 7.0+)
- **Docker**: 20.10+ (å¯é€‰ï¼Œç”¨äºå®¹å™¨åŒ–éƒ¨ç½²)

### ğŸ“¦ å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/phuhao00/greatestworks.git
cd greatestworks

# å®‰è£…Goä¾èµ–
go mod tidy
```

### âš™ï¸ é…ç½®æ–‡ä»¶

é¡¹ç›®ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„é…ç½®ï¼š

**Windows (PowerShell):**
```powershell
Copy-Item configs/auth-service.yaml configs/auth-service-dev.yaml
Copy-Item configs/gateway-service.yaml configs/gateway-service-dev.yaml
Copy-Item configs/game-service.yaml configs/game-service-dev.yaml
```

**Linux / macOS:**
```bash
cp configs/auth-service.yaml configs/auth-service-dev.yaml
cp configs/gateway-service.yaml configs/gateway-service-dev.yaml
cp configs/game-service.yaml configs/game-service-dev.yaml
```

### ğŸ® å¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

**Windows:**
```powershell
scripts/start-services.bat
```

**Linux/Mac:**
```bash
./scripts/start-services.sh
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# å¯åŠ¨è®¤è¯æœåŠ¡
go run cmd/auth-service/main.go

# å¯åŠ¨æ¸¸æˆæœåŠ¡ï¼ˆæ–°ç»ˆç«¯ï¼‰
go run cmd/game-service/main.go

# å¯åŠ¨ç½‘å…³æœåŠ¡ï¼ˆæ–°ç»ˆç«¯ï¼‰
go run cmd/gateway-service/main.go
```

> æç¤ºï¼šç½‘å…³æœåŠ¡éœ€è¦å¯ç”¨çš„ MongoDB å®ä¾‹ç”¨äºç©å®¶ä½ç½®æŒä¹…åŒ–ã€‚è‹¥æœªæ‰‹åŠ¨éƒ¨ç½²æ•°æ®åº“ï¼Œå»ºè®®å…ˆæ‰§è¡Œ `docker-compose up -d` å¯åŠ¨ä¾èµ–ç¯å¢ƒã€‚

#### æ–¹å¼ä¸‰ï¼šDockerå¯åŠ¨

```bash
# å¯åŠ¨å®Œæ•´ç¯å¢ƒ
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### ğŸ”§ æœåŠ¡åœ°å€

å¯åŠ¨åï¼Œå„æœåŠ¡å°†åœ¨ä»¥ä¸‹åœ°å€è¿è¡Œï¼š

- **è®¤è¯æœåŠ¡**: http://localhost:8080 (å®¢æˆ·ç«¯å¯è®¿é—®)
- **ç½‘å…³æœåŠ¡**: tcp://localhost:9090 (å®¢æˆ·ç«¯å¯è®¿é—®)
- **æ¸¸æˆæœåŠ¡**: rpc://localhost:8081 (ä»…å†…éƒ¨æœåŠ¡è®¿é—®ï¼Œå®¢æˆ·ç«¯ä¸å¯ç›´æ¥è®¿é—®)

### ğŸ“¡ å®¢æˆ·ç«¯è®¿é—®è¯´æ˜

- **å®¢æˆ·ç«¯ â†’ è®¤è¯æœåŠ¡**: ç›´æ¥HTTPè®¿é—®ï¼Œç”¨äºç”¨æˆ·è®¤è¯
- **å®¢æˆ·ç«¯ â†’ ç½‘å…³æœåŠ¡**: ç›´æ¥TCPè¿æ¥ï¼Œç”¨äºæ¸¸æˆæ•°æ®äº¤äº’
- **å®¢æˆ·ç«¯ â†’ æ¸¸æˆæœåŠ¡**: âŒ ä¸ç›´æ¥è®¿é—®ï¼Œæ‰€æœ‰æ¸¸æˆé€»è¾‘é€šè¿‡ç½‘å…³æœåŠ¡è½¬å‘

## ğŸ›ï¸ æŠ€æœ¯æ¶æ„å›¾

### ğŸ¯ æ•´ä½“æ¶æ„
```mermaid
flowchart TB
    C[å®¢æˆ·ç«¯] -->|HTTP| AUTH[è®¤è¯æœåŠ¡\nHTTP:8080]
    C -->|TCP| GW[ç½‘å…³æœåŠ¡\nTCP:9090]
    GW -->|Go RPC| GAME[æ¸¸æˆæœåŠ¡\nRPC:8081]

    GAME --> M[(MongoDB)]
    GAME --> R[(Redis)]
    GAME -.äº‹ä»¶.-> N[(NATS)]
```

### ğŸ—ï¸ DDDåˆ†å±‚æ¶æ„
```mermaid
flowchart TB
    subgraph Interface[æ¥å£å±‚]
      HTTP[HTTP\nREST]
      TCP[TCP\nGame Protocol]
      RPC[RPC\nInternal]
    end

    subgraph Application[åº”ç”¨å±‚]
      CMD[å‘½ä»¤å¤„ç†å™¨]
      QRY[æŸ¥è¯¢å¤„ç†å™¨]
      APP[åº”ç”¨æœåŠ¡/ç¼–æ’]
    end

    subgraph Domain[é¢†åŸŸå±‚]
      AGG[èšåˆæ ¹/å®ä½“/å€¼å¯¹è±¡]
      DSVC[é¢†åŸŸæœåŠ¡]
      DEVT[é¢†åŸŸäº‹ä»¶]
    end

    subgraph Infra[åŸºç¡€è®¾æ–½å±‚]
      PERS[æŒä¹…åŒ–]
      MSG[æ¶ˆæ¯]
      NET[ç½‘ç»œ]
      CFG[é…ç½®]
      LOG[æ—¥å¿—]
    end

    Interface --> Application --> Domain
    Domain --> Infra
```

## ğŸ›ï¸ DDDé¢†åŸŸæ¶æ„

### æ ¸å¿ƒé¢†åŸŸ (Core Domains)

#### ğŸ® ç©å®¶é¢†åŸŸ (Player Domain)
- **èŒè´£**: ç©å®¶åŸºç¡€ä¿¡æ¯ã€ç­‰çº§ç»éªŒã€å±æ€§ç®¡ç†
- **æ ¸å¿ƒå®ä½“**: Player, PlayerStats, PlayerProfile
- **ä¸»è¦åŠŸèƒ½**: ç©å®¶åˆ›å»ºã€å‡çº§ã€å±æ€§è®¡ç®—ã€çŠ¶æ€ç®¡ç†

#### âš”ï¸ æˆ˜æ–—é¢†åŸŸ (Battle Domain)
- **èŒè´£**: æˆ˜æ–—é€»è¾‘ã€æŠ€èƒ½ç³»ç»Ÿã€ä¼¤å®³è®¡ç®—
- **æ ¸å¿ƒå®ä½“**: Battle, Skill, Damage, BattleResult
- **ä¸»è¦åŠŸèƒ½**: PvP/PvEæˆ˜æ–—ã€æŠ€èƒ½é‡Šæ”¾ã€æˆ˜æ–—ç»“ç®—

#### ğŸ  ç¤¾äº¤é¢†åŸŸ (Social Domain)
- **èŒè´£**: èŠå¤©ã€å¥½å‹ã€å®¶æ—ã€é˜Ÿä¼ç³»ç»Ÿ
- **æ ¸å¿ƒå®ä½“**: Chat, Friend, Guild, Team, Mail
- **ä¸»è¦åŠŸèƒ½**: ç¤¾äº¤äº’åŠ¨ã€ç»„é˜Ÿåä½œã€æ¶ˆæ¯é€šä¿¡

#### ğŸ—ï¸ å»ºç­‘é¢†åŸŸ (Building Domain)
- **èŒè´£**: å»ºç­‘ç³»ç»Ÿã€å®¶å›­ç®¡ç†ã€å»ºç­‘å‡çº§
- **æ ¸å¿ƒå®ä½“**: Building, BuildingTemplate, BuildingUpgrade
- **ä¸»è¦åŠŸèƒ½**: å»ºç­‘å»ºé€ ã€å‡çº§ã€åŠŸèƒ½ç®¡ç†

#### ğŸ¾ å® ç‰©é¢†åŸŸ (Pet Domain)
- **èŒè´£**: å® ç‰©ç³»ç»Ÿã€å® ç‰©åŸ¹å…»ã€å® ç‰©æˆ˜æ–—
- **æ ¸å¿ƒå®ä½“**: Pet, PetTemplate, PetSkill
- **ä¸»è¦åŠŸèƒ½**: å® ç‰©è·å–ã€åŸ¹å…»ã€è¿›åŒ–ã€æˆ˜æ–—è¾…åŠ©

#### ğŸ† æ’è¡Œæ¦œé¢†åŸŸ (Ranking Domain)
- **èŒè´£**: å„ç±»æ’è¡Œæ¦œã€ç§¯åˆ†ç»Ÿè®¡ã€å¥–åŠ±å‘æ”¾
- **æ ¸å¿ƒå®ä½“**: Ranking, RankingEntry, RankingReward
- **ä¸»è¦åŠŸèƒ½**: æ’åè®¡ç®—ã€æ¦œå•æ›´æ–°ã€å¥–åŠ±åˆ†å‘

#### ğŸ¯ å°æ¸¸æˆé¢†åŸŸ (Minigame Domain)
- **èŒè´£**: å„ç§å°æ¸¸æˆã€æ´»åŠ¨ç©æ³•ã€ç‰¹æ®Šå¥–åŠ±
- **æ ¸å¿ƒå®ä½“**: Minigame, MinigameSession, MinigameReward
- **ä¸»è¦åŠŸèƒ½**: å°æ¸¸æˆé€»è¾‘ã€ç§¯åˆ†è®¡ç®—ã€å¥–åŠ±å‘æ”¾

## ğŸŒ ç½‘ç»œåè®®è®¾è®¡

### å¤šåè®®æ”¯æŒ
- **HTTP**: è®¤è¯æœåŠ¡ï¼ŒRESTful API
- **TCP**: ç½‘å…³æœåŠ¡ï¼Œæ¸¸æˆå®¢æˆ·ç«¯è¿æ¥
- **RPC**: æœåŠ¡é—´é€šä¿¡ï¼ŒGoåŸç”ŸRPC

### TCPåè®®æ ¼å¼
```
+--------+--------+--------+----------+
| Magic  | Length | Type   | Data     |
| 2bytes | 4bytes | 2bytes | Variable |
+--------+--------+--------+----------+
```

### æ¶ˆæ¯åˆ†ç±»
- **0x1xxx**: ç³»ç»Ÿæ¶ˆæ¯ (ç™»å½•ã€å¿ƒè·³ã€é”™è¯¯)
- **0x2xxx**: ç©å®¶æ¶ˆæ¯ (å±æ€§ã€çŠ¶æ€ã€å‡çº§)
- **0x3xxx**: ç¤¾äº¤æ¶ˆæ¯ (èŠå¤©ã€å¥½å‹ã€é‚®ä»¶)
- **0x4xxx**: æˆ˜æ–—æ¶ˆæ¯ (æŠ€èƒ½ã€ä¼¤å®³ã€ç»“æœ)
- **0x5xxx**: å»ºç­‘æ¶ˆæ¯ (å»ºé€ ã€å‡çº§ã€ç®¡ç†)
- **0x6xxx**: å® ç‰©æ¶ˆæ¯ (è·å–ã€åŸ¹å…»ã€æˆ˜æ–—)
- **0x7xxx**: æ’è¡Œæ¦œæ¶ˆæ¯ (æŸ¥è¯¢ã€æ›´æ–°ã€å¥–åŠ±)
- **0x8xxx**: å°æ¸¸æˆæ¶ˆæ¯ (å¼€å§‹ã€æ“ä½œã€ç»“ç®—)
- **0x9xxx**: ç®¡ç†æ¶ˆæ¯ (GMå‘½ä»¤ã€ç³»ç»Ÿå…¬å‘Š)

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨è®¾è®¡

### MongoDB é›†åˆè®¾è®¡

#### æ ¸å¿ƒä¸šåŠ¡é›†åˆ
- **players**: ç©å®¶åŸºç¡€ä¿¡æ¯å’ŒçŠ¶æ€
- **player_stats**: ç©å®¶ç»Ÿè®¡æ•°æ®å’Œå±æ€§
- **battles**: æˆ˜æ–—è®°å½•å’Œç»“æœ
- **guilds**: å…¬ä¼šä¿¡æ¯å’Œæˆå‘˜å…³ç³»
- **buildings**: å»ºç­‘æ•°æ®å’ŒçŠ¶æ€
- **pets**: å® ç‰©ä¿¡æ¯å’Œå±æ€§
- **rankings**: æ’è¡Œæ¦œæ•°æ®å’Œå†å²
- **minigames**: å°æ¸¸æˆè®°å½•å’Œç§¯åˆ†

### Redis ç¼“å­˜ç­–ç•¥

#### çƒ­ç‚¹æ•°æ®ç¼“å­˜
- **åœ¨çº¿ç©å®¶**: `online:players:{server_id}`
- **ç©å®¶ä¼šè¯**: `session:{player_id}`
- **æ’è¡Œæ¦œ**: `ranking:{type}:{period}`
- **å…¬ä¼šä¿¡æ¯**: `guild:{guild_id}`

#### ä¸´æ—¶æ•°æ®ç¼“å­˜
- **æˆ˜æ–—çŠ¶æ€**: `battle:{battle_id}`
- **é˜Ÿä¼ä¿¡æ¯**: `team:{team_id}`
- **èŠå¤©é¢‘é“**: `chat:{channel_id}`
- **æ´»åŠ¨çŠ¶æ€**: `event:{event_id}`

## ğŸ‘¨â€ğŸ’» å¼€å‘æŒ‡å—

### ğŸ—ï¸ DDDå¼€å‘æ¨¡å¼

#### æ·»åŠ æ–°é¢†åŸŸ
1. åœ¨ `internal/domain/` ä¸‹åˆ›å»ºé¢†åŸŸç›®å½•
2. å®šä¹‰é¢†åŸŸå®ä½“ã€å€¼å¯¹è±¡å’Œèšåˆæ ¹
3. å®ç°é¢†åŸŸæœåŠ¡å’Œä»“å‚¨æ¥å£
4. åˆ›å»ºå¯¹åº”çš„åº”ç”¨æœåŠ¡
5. å®ç°åŸºç¡€è®¾æ–½å±‚çš„å…·ä½“å®ç°
6. æ·»åŠ æ¥å£å±‚çš„å¤„ç†å™¨

#### é¢†åŸŸå¼€å‘è§„èŒƒ
```go
// é¢†åŸŸå®ä½“ç¤ºä¾‹
type Player struct {
    id       PlayerID
    name     string
    level    int
    exp      int64
    stats    PlayerStats
    // é¢†åŸŸè¡Œä¸º
}

func (p *Player) LevelUp() error {
    // é¢†åŸŸé€»è¾‘å®ç°
}
```

### ğŸ”§ å¼€å‘å·¥å…·ä½¿ç”¨

#### Makeå‘½ä»¤
```bash
make setup      # åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ
make dev        # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
make build      # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
make test       # è¿è¡Œæµ‹è¯•
make lint       # ä»£ç è´¨é‡æ£€æŸ¥
make clean      # æ¸…ç†æ„å»ºäº§ç‰©
make docs       # ç”Ÿæˆæ–‡æ¡£
```

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### æ•°æ®åº“ä¼˜åŒ–
- **è¿æ¥æ± ç®¡ç†**: åˆç†é…ç½®MongoDBå’ŒRedisè¿æ¥æ± 
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºæŸ¥è¯¢é¢‘ç¹çš„å­—æ®µåˆ›å»ºåˆé€‚ç´¢å¼•
- **åˆ†ç‰‡ç­–ç•¥**: å¤§æ•°æ®é‡é›†åˆé‡‡ç”¨åˆ†ç‰‡å­˜å‚¨
- **è¯»å†™åˆ†ç¦»**: è¯»æ“ä½œä½¿ç”¨ä»åº“ï¼Œå†™æ“ä½œä½¿ç”¨ä¸»åº“

#### ç¼“å­˜ç­–ç•¥
- **å¤šçº§ç¼“å­˜**: å†…å­˜ç¼“å­˜ + Redisç¼“å­˜ + æ•°æ®åº“
- **ç¼“å­˜é¢„çƒ­**: æœåŠ¡å¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®
- **ç¼“å­˜æ›´æ–°**: é‡‡ç”¨Cache-Asideæ¨¡å¼æ›´æ–°ç¼“å­˜
- **ç¼“å­˜ç©¿é€**: ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç¼“å­˜ç©¿é€

#### ç½‘ç»œä¼˜åŒ–
- **è¿æ¥å¤ç”¨**: TCPè¿æ¥æ± å’ŒHTTP Keep-Alive
- **æ¶ˆæ¯æ‰¹å¤„ç†**: æ‰¹é‡å¤„ç†éå®æ—¶æ¶ˆæ¯
- **å‹ç¼©ä¼ è¾“**: å¤§æ•°æ®åŒ…å¯ç”¨å‹ç¼©
- **åè®®ä¼˜åŒ–**: ä½¿ç”¨äºŒè¿›åˆ¶åè®®å‡å°‘ä¼ è¾“å¼€é”€

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ğŸ³ Dockeréƒ¨ç½²

#### Docker Composeéƒ¨ç½²
```bash
# å¯åŠ¨å®Œæ•´ç¯å¢ƒï¼ˆåŒ…å«MongoDBã€Redisï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

#### å•å®¹å™¨éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t greatestworks .

# è¿è¡Œè®¤è¯æœåŠ¡
docker run -d --name auth-service -p 8080:8080 greatestworks auth-service

# è¿è¡Œæ¸¸æˆæœåŠ¡
docker run -d --name game-service -p 8081:8081 greatestworks game-service

# è¿è¡Œç½‘å…³æœåŠ¡
docker run -d --name gateway-service -p 9090:9090 greatestworks gateway-service
```

### â˜¸ï¸ Kuberneteséƒ¨ç½²

é¡¹ç›®æä¾›äº†å®Œæ•´çš„ Kubernetes æœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆï¼Œæ”¯æŒ Docker Desktop å’Œ Minikubeã€‚æ‰€æœ‰ k8s é…ç½®æ–‡ä»¶ä½äº `k8s/local/` ç›®å½•ã€‚

#### ğŸ“‹ å‰ç½®è¦æ±‚

- **Kubernetes**: Docker Desktop å†…ç½® k8s æˆ– Minikube 1.28+
- **kubectl**: ä¸é›†ç¾¤ç‰ˆæœ¬åŒ¹é…
- **Docker**: 20.10+ (ç”¨äºæ„å»ºé•œåƒ)
- **PowerShell**: 5.1+ (Windows) æˆ– Bash (Linux/macOS)

#### ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆä¸‰æ­¥å¯åŠ¨ï¼‰

**æ­¥éª¤ 1: æ„å»ºæœåŠ¡é•œåƒ**

```powershell
# Windows PowerShell
./scripts/build-images.ps1 -Tag dev

# Linux / macOS
./scripts/build-images.sh -t dev
```

æ„å»ºäº§ç‰©:
- `greatestworks-auth:dev` (è®¤è¯æœåŠ¡)
- `greatestworks-game:dev` (æ¸¸æˆæœåŠ¡)
- `greatestworks-gateway:dev` (ç½‘å…³æœåŠ¡)

**æ­¥éª¤ 2: åŠ è½½é•œåƒåˆ° Kubernetes èŠ‚ç‚¹**

> æ­¤æ­¥éª¤è§£å†³ Docker Desktop k8s æ— æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°é•œåƒçš„é—®é¢˜ã€‚

```powershell
# Windows PowerShell
./scripts/load-images-to-k8s.ps1 -Tag dev

# Minikube ç”¨æˆ·æ›¿ä»£æ–¹æ¡ˆ
minikube image load greatestworks-auth:dev
minikube image load greatestworks-game:dev
minikube image load greatestworks-gateway:dev
minikube image load mongo:7
minikube image load redis:7
```

**æ­¥éª¤ 3: éƒ¨ç½²åˆ°é›†ç¾¤**

```powershell
# åˆ›å»ºå‘½åç©ºé—´å’Œéƒ¨ç½²æ‰€æœ‰æœåŠ¡
kubectl apply -f k8s/local/namespace.yaml
kubectl apply -f k8s/local/mongodb.yaml
kubectl apply -f k8s/local/redis.yaml
kubectl apply -f k8s/local/configmap-gateway.yaml
kubectl apply -f k8s/local/auth-service.yaml
kubectl apply -f k8s/local/game-service.yaml
kubectl apply -f k8s/local/gateway-service.yaml

# ç­‰å¾… Pod å°±ç»ªï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰
kubectl -n gaming get pods -w
```

é¢„æœŸè¾“å‡ºï¼ˆæ‰€æœ‰ Pod çŠ¶æ€ä¸º `Running` ä¸” `READY` ä¸º `1/1`ï¼‰:

```
NAME                               READY   STATUS    RESTARTS   AGE
auth-service-xxxxxxxxx-xxxxx       1/1     Running   0          2m
game-service-xxxxxxxxx-xxxxx       1/1     Running   0          2m
gateway-service-xxxxxxxxx-xxxxx    1/1     Running   0          2m
mongodb-xxxxxxxxx-xxxxx            1/1     Running   0          2m
redis-xxxxxxxxx-xxxxx              1/1     Running   0          2m
```

#### ğŸŒ è®¿é—®æœåŠ¡

éƒ¨ç½²æˆåŠŸåï¼ŒæœåŠ¡é€šè¿‡ NodePort æš´éœ²åœ¨æœ¬åœ°ï¼š

| æœåŠ¡ | åè®® | ç«¯å£ | è®¿é—®åœ°å€ | ç”¨é€” |
|-----|------|------|---------|------|
| **è®¤è¯æœåŠ¡** | HTTP | 30080 | `http://localhost:30080` | ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€JWT éªŒè¯ |
| **ç½‘å…³æœåŠ¡** | TCP | 30909 | `localhost:30909` | æ¸¸æˆå®¢æˆ·ç«¯é•¿è¿æ¥å…¥å£ |
| **æ¸¸æˆæœåŠ¡** | RPC | 8081 | ä»…é›†ç¾¤å†…éƒ¨ | æ¸¸æˆé€»è¾‘å¤„ç†ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰ |
| **MongoDB** | TCP | 27017 | ä»…é›†ç¾¤å†…éƒ¨ | æ•°æ®æŒä¹…åŒ– |
| **Redis** | TCP | 6379 | ä»…é›†ç¾¤å†…éƒ¨ | ç¼“å­˜ä¸ä¼šè¯ |

**éªŒè¯æœåŠ¡å¯ç”¨æ€§:**

```powershell
# æŸ¥çœ‹æœåŠ¡ç«¯ç‚¹
kubectl -n gaming get svc

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl -n gaming logs -l app=auth-service --tail=50
kubectl -n gaming logs -l app=gateway-service --tail=50
kubectl -n gaming logs -l app=game-service --tail=50

# æµ‹è¯•è®¤è¯æœåŠ¡å¥åº·æ£€æŸ¥ï¼ˆå¦‚æœå®ç°äº† /health ç«¯ç‚¹ï¼‰
curl http://localhost:30080/health
```

#### ğŸ”§ å¸¸è§æ“ä½œ

**æŸ¥çœ‹é›†ç¾¤çŠ¶æ€:**

```powershell
# æŸ¥çœ‹æ‰€æœ‰èµ„æº
kubectl -n gaming get all

# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl -n gaming describe pod <pod-name>

# è¿›å…¥å®¹å™¨è°ƒè¯•
kubectl -n gaming exec -it <pod-name> -- sh
```

**é‡å¯æœåŠ¡ï¼ˆåº”ç”¨é…ç½®æ›´æ”¹åï¼‰:**

```powershell
# é‡å¯å•ä¸ªæœåŠ¡
kubectl -n gaming rollout restart deploy/auth-service

# é‡å¯æ‰€æœ‰æœåŠ¡
kubectl -n gaming rollout restart deploy --all

# ç­‰å¾…æ»šåŠ¨æ›´æ–°å®Œæˆ
kubectl -n gaming rollout status deploy/auth-service
```

**æ›´æ–°é•œåƒï¼ˆä»£ç å˜æ›´åï¼‰:**

```powershell
# 1. é‡æ–°æ„å»ºé•œåƒ
./scripts/build-images.ps1 -Tag dev

# 2. é‡æ–°åŠ è½½åˆ° k8s èŠ‚ç‚¹
./scripts/load-images-to-k8s.ps1 -Tag dev

# 3. å¼ºåˆ¶é‡å¯ Podï¼ˆè§¦å‘é•œåƒé‡æ–°æ‹‰å–ï¼‰
kubectl -n gaming rollout restart deploy --all
```

**æ¸…ç†ç¯å¢ƒ:**

```powershell
# åˆ é™¤æ‰€æœ‰èµ„æºï¼ˆä¿ç•™å‘½åç©ºé—´ï¼‰
kubectl delete -f k8s/local/gateway-service.yaml
kubectl delete -f k8s/local/game-service.yaml
kubectl delete -f k8s/local/auth-service.yaml
kubectl delete -f k8s/local/configmap-gateway.yaml
kubectl delete -f k8s/local/redis.yaml
kubectl delete -f k8s/local/mongodb.yaml

# åˆ é™¤å‘½åç©ºé—´ï¼ˆä¼šçº§è”åˆ é™¤æ‰€æœ‰èµ„æºï¼‰
kubectl delete namespace gaming
```

#### ğŸ“¦ æ¨é€é•œåƒåˆ°è¿œç¨‹ä»“åº“ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åœ¨å¤šå°æœºå™¨æˆ– CI/CD ç¯å¢ƒä¸­éƒ¨ç½²ï¼Œå¯ä»¥å°†é•œåƒæ¨é€åˆ° Docker Hub æˆ–ç§æœ‰ä»“åº“ï¼š

**æ–¹å¼ 1: ä½¿ç”¨å‘å¸ƒè„šæœ¬**

```powershell
# ç™»å½• Docker Hub
docker login

# æ¨é€é•œåƒåˆ°ä½ çš„ä»“åº“
./scripts/publish-images.ps1 `
  -Registry docker.io `
  -Namespace YOUR_DOCKERHUB_USERNAME `
  -Tag dev `
  -IncludeInfra  # å¯é€‰ï¼šåŒæ—¶æ¨é€ mongo å’Œ redis
```

**æ–¹å¼ 2: ä½¿ç”¨ Kustomize è¦†ç›–å±‚**

é¡¹ç›®æä¾›äº† `k8s/local/overlays/registry/` é…ç½®ï¼Œå¯ä»¥åœ¨éƒ¨ç½²æ—¶è‡ªåŠ¨æ›¿æ¢é•œåƒè·¯å¾„ï¼š

```powershell
# 1. ç¼–è¾‘ k8s/local/overlays/registry/kustomization.yaml
#    å°† REPLACE_ME æ›¿æ¢ä¸ºä½ çš„ä»“åº“å‘½åç©ºé—´ï¼Œä¾‹å¦‚ï¼šdocker.io/phuhao00

# 2. ä½¿ç”¨ kustomize éƒ¨ç½²
kubectl apply -k k8s/local/overlays/registry

# 3. éªŒè¯éƒ¨ç½²
kubectl -n gaming get pods
```

#### ğŸ› æ•…éšœæ’æŸ¥

**é—®é¢˜ 1: Pod çŠ¶æ€ä¸º `ImagePullBackOff` æˆ– `ErrImagePull`**

**åŸå› **: Kubernetes æ— æ³•ä»æœ¬åœ° Docker æ‹‰å–é•œåƒã€‚

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿å·²æ‰§è¡Œ `./scripts/load-images-to-k8s.ps1`
- æ£€æŸ¥ Pod çš„ `imagePullPolicy` æ˜¯å¦ä¸º `IfNotPresent`
- éªŒè¯é•œåƒå·²åŠ è½½: `kubectl -n gaming describe pod <pod-name> | Select-String -Pattern "Image"`

**é—®é¢˜ 2: Pod çŠ¶æ€ä¸º `CrashLoopBackOff`**

**åŸå› **: æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œé€šå¸¸æ˜¯é…ç½®é”™è¯¯æˆ–ä¾èµ–æœªå°±ç»ªã€‚

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# æŸ¥çœ‹å´©æºƒæ—¥å¿—
kubectl -n gaming logs <pod-name> --previous

# å¸¸è§åŸå› ï¼š
# - MongoDB/Redis æœªå°±ç»ª â†’ ç­‰å¾…åŸºç¡€è®¾æ–½ Pod å…ˆå¯åŠ¨
# - ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯ â†’ æ£€æŸ¥ Deployment çš„ env é…ç½®
# - ç«¯å£å†²çª â†’ æ£€æŸ¥ containerPort å’Œ Service port æ˜ å°„
```

**é—®é¢˜ 3: æ— æ³•é€šè¿‡ NodePort è®¿é—®æœåŠ¡**

**åŸå› **: NodePort æœªæ­£ç¡®æ˜ å°„æˆ–é˜²ç«å¢™é˜»æ­¢ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# éªŒè¯ Service é…ç½®
kubectl -n gaming get svc

# ç¡®è®¤ NodePort èŒƒå›´ï¼ˆé»˜è®¤ 30000-32767ï¼‰
# æ£€æŸ¥ Windows é˜²ç«å¢™æˆ– Docker Desktop ç½‘ç»œè®¾ç½®

# ä¸´æ—¶æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ç«¯å£è½¬å‘
kubectl -n gaming port-forward svc/auth-service 8080:8080
kubectl -n gaming port-forward svc/gateway-service 9090:9090
```

**é—®é¢˜ 4: MongoDB/Redis è¿æ¥å¤±è´¥**

**åŸå› **: æœåŠ¡å¯åŠ¨é¡ºåºé—®é¢˜æˆ– DNS è§£æå¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```powershell
# æ£€æŸ¥åŸºç¡€è®¾æ–½æœåŠ¡æ˜¯å¦è¿è¡Œ
kubectl -n gaming get pods -l app=mongodb
kubectl -n gaming get pods -l app=redis

# éªŒè¯æœåŠ¡ DNS è§£æï¼ˆåœ¨ Pod å†…æµ‹è¯•ï¼‰
kubectl -n gaming exec -it <auth-pod> -- nslookup mongodb
kubectl -n gaming exec -it <auth-pod> -- nslookup redis

# æ£€æŸ¥æœåŠ¡ç«¯ç‚¹
kubectl -n gaming get endpoints
```

#### ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

**å®æ—¶æŸ¥çœ‹æ—¥å¿—:**

```powershell
# è·Ÿè¸ªå•ä¸ªæœåŠ¡
kubectl -n gaming logs -f deploy/auth-service

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—ï¼ˆå¤šçª—å£ï¼‰
kubectl -n gaming logs -f -l app=auth-service
kubectl -n gaming logs -f -l app=game-service
kubectl -n gaming logs -f -l app=gateway-service

# æŸ¥çœ‹ Pod äº‹ä»¶
kubectl -n gaming get events --sort-by='.lastTimestamp'
```

**èµ„æºä½¿ç”¨æƒ…å†µ:**

```powershell
# æŸ¥çœ‹ Pod èµ„æºå ç”¨
kubectl -n gaming top pods

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æº
kubectl top nodes
```

#### ğŸ” ç”Ÿäº§ç¯å¢ƒå¢å¼ºé…ç½®

æœ¬åœ°éƒ¨ç½²ä½¿ç”¨ç®€åŒ–é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®å¢å¼ºï¼š

**å®‰å…¨æ€§:**
- ä½¿ç”¨ Kubernetes Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼ˆæ•°æ®åº“å¯†ç ã€JWTå¯†é’¥ï¼‰
- å¯ç”¨ NetworkPolicy é™åˆ¶ Pod é—´é€šä¿¡
- é…ç½® RBAC æƒé™æ§åˆ¶
- ä½¿ç”¨ TLS åŠ å¯†æœåŠ¡é—´é€šä¿¡

**é«˜å¯ç”¨:**
- å¢åŠ å‰¯æœ¬æ•° (`replicas: 3`)
- é…ç½® PodDisruptionBudget
- ä½¿ç”¨ StatefulSet éƒ¨ç½²æœ‰çŠ¶æ€æœåŠ¡ï¼ˆMongoDBï¼‰
- å¯ç”¨ HorizontalPodAutoscaler è‡ªåŠ¨æ‰©ç¼©å®¹

**æŒä¹…åŒ–:**
- ä¸º MongoDB é…ç½® PersistentVolumeClaimï¼ˆé¿å…ä½¿ç”¨ emptyDirï¼‰
- å®šæœŸå¤‡ä»½æ•°æ®åº“
- é…ç½®æ•°æ®ä¿ç•™ç­–ç•¥

**ç¤ºä¾‹ï¼šç”Ÿäº§çº§ MongoDB éƒ¨ç½²**

```yaml
# ä½¿ç”¨ StatefulSet + PVCï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mongodb
  namespace: gaming
spec:
  serviceName: mongodb
  replicas: 3
  selector:
    matchLabels:
      app: mongodb
  template:
    spec:
      containers:
      - name: mongodb
        image: mongo:7
        volumeMounts:
        - name: mongo-data
          mountPath: /data/db
  volumeClaimTemplates:
  - metadata:
      name: mongo-data
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: 10Gi
```

#### ğŸ¯ æ€§èƒ½è°ƒä¼˜å»ºè®®

**èµ„æºé…é¢è°ƒæ•´:**

æ ¹æ®å®é™…è´Ÿè½½ä¿®æ”¹ `k8s/local/*-service.yaml` ä¸­çš„èµ„æºé™åˆ¶ï¼š

```yaml
resources:
  requests:
    cpu: "500m"      # ä¿è¯åˆ†é…
    memory: "512Mi"
  limits:
    cpu: "2"         # æœ€å¤§ä½¿ç”¨
    memory: "2Gi"
```

**å¹¶å‘è¿æ¥ä¼˜åŒ–:**

åœ¨ `k8s/local/configmap-gateway.yaml` ä¸­è°ƒæ•´ç½‘å…³é…ç½®ï¼š

```yaml
server:
  tcp:
    max_connections: 50000  # æ ¹æ®èŠ‚ç‚¹èƒ½åŠ›è°ƒæ•´
    buffer_size: 8192       # å¢å¤§ç¼“å†²åŒº
```

**æ•°æ®åº“è¿æ¥æ± :**

åœ¨å„æœåŠ¡é…ç½®ä¸­ä¼˜åŒ–è¿æ¥æ± å‚æ•°ï¼š

```yaml
database:
  mongodb:
    max_pool_size: 200
    min_pool_size: 50
  redis:
    pool_size: 200
    min_idle_conns: 50
```

#### ğŸ“š ç›¸å…³æ–‡æ¡£

- [Kubernetes é…ç½®æ¸…å•è¯´æ˜](k8s/local/README.md)ï¼ˆå¾…åˆ›å»ºï¼‰
- [Docker é•œåƒæ„å»ºè„šæœ¬](scripts/build-images.ps1)
- [é•œåƒåŠ è½½è„šæœ¬](scripts/load-images-to-k8s.ps1)
- [Kustomize è¦†ç›–å±‚](k8s/local/overlays/registry/)

---

### ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®

#### ç¯å¢ƒå˜é‡
```bash
# æœåŠ¡é…ç½®
export SERVICE_TYPE="auth-service"  # auth-service, game-service, gateway-service
export SERVER_PORT=8080
export SERVER_HOST=0.0.0.0

# æ•°æ®åº“é…ç½®
export MONGODB_URI="mongodb://mongo-cluster:27017/gamedb"
export REDIS_ADDR="redis-cluster:6379"

# è®¤è¯é…ç½®
export JWT_SECRET="your-production-secret-key"

# æ—¥å¿—é…ç½®
export LOG_LEVEL=info
export LOG_FORMAT=json
```

## ğŸ“š æ–‡æ¡£ä¸å›¾ç¤º

- `docs/diagrams/README.md`ï¼šæ¶æ„ç¤ºæ„ä¸ä¸Šä¸‹æ¸¸å…³ç³»è¯´æ˜ï¼Œé™„å¸¦ module / svr.frame / uml ç­‰ Draw.io æºæ–‡ä»¶ã€‚
- `internal/readme.md`ï¼šå†…éƒ¨æ¨¡å—å¿«é€Ÿç´¢å¼•ï¼ŒåŒ…æ‹¬é¢†åŸŸå±‚ã€åŸºç¡€è®¾æ–½å±‚ä¸æ¥å£å±‚çš„èŒè´£æ¢³ç†ã€‚
- `module.drawio.png`ã€`svr.drawio.png`ï¼šé¢å‘æ±‡æŠ¥çš„é™æ€æ¶æ„å›¾ï¼Œå¯ç›´æ¥åµŒå…¥æ–‡æ¡£æˆ– PPTã€‚
- è‹¥éœ€è¦ç”Ÿæˆåè®®æ–‡æ¡£ï¼Œå¯è¿è¡Œ `scripts/generate_proto.sh` / `.bat` ååœ¨ `proto/` ç›®å½•æŸ¥é˜…æœ€æ–°çš„ `.proto` å®šä¹‰ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼è¯·é˜…è¯» [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚

### è´¡çŒ®æµç¨‹
1. **Fork** é¡¹ç›®åˆ°ä½ çš„GitHubè´¦æˆ·
2. **åˆ›å»º** åŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. **æäº¤** ä½ çš„æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. **æ¨é€** åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. **åˆ›å»º** Pull Request

### å¼€å‘è§„èŒƒ
- éµå¾ª [Goä»£ç è§„èŒƒ](https://golang.org/doc/effective_go.html)
- ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œä¿æŒæµ‹è¯•è¦†ç›–ç‡ > 80%
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- é€šè¿‡æ‰€æœ‰CIæ£€æŸ¥

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ è”ç³»æˆ‘ä»¬

- **QQç¾¤**: 366905799
- **é¡¹ç›®ä¸»é¡µ**: [https://github.com/phuhao00/greatestworks](https://github.com/phuhao00/greatestworks)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/phuhao00/greatestworks/issues)
- **è®¨è®ºäº¤æµ**: [GitHub Discussions](https://github.com/phuhao00/greatestworks/discussions)

## ğŸ“ˆ é¡¹ç›®çŠ¶æ€

![Build Status](https://github.com/phuhao00/greatestworks/workflows/CI/badge.svg)
![Go Version](https://img.shields.io/badge/Go-1.24+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)
![Docker Pulls](https://img.shields.io/docker/pulls/greatestworks/server.svg)

## ğŸ¯ è·¯çº¿å›¾

### v2.0.0 (è®¡åˆ’ä¸­)
- [ ] æœåŠ¡ç½‘æ ¼é›†æˆ
- [ ] GraphQL APIæ”¯æŒ
- [ ] å®æ—¶æ•°æ®åˆ†æå’ŒBI
- [ ] å¤šè¯­è¨€å®¢æˆ·ç«¯SDK
- [ ] äº‘åŸç”Ÿéƒ¨ç½²ä¼˜åŒ–

### v1.5.0 (å¼€å‘ä¸­)
- [ ] ç®¡ç†åå°ç•Œé¢
- [ ] æ€§èƒ½ç›‘æ§é¢æ¿
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–
- [ ] æœåŠ¡å‘ç°é›†æˆ

### v1.0.0 âœ… (å·²å‘å¸ƒ)
- [x] åˆ†å¸ƒå¼æ¶æ„é‡æ„å®Œæˆ
- [x] å¤šèŠ‚ç‚¹æœåŠ¡åˆ†ç¦»
- [x] GoåŸç”ŸRPCé€šä¿¡
- [x] Dockerå®¹å™¨åŒ–æ”¯æŒ
- [x] åŸºç¡€ç›‘æ§å’Œæ—¥å¿—
- [x] å®Œæ•´æ–‡æ¡£ä½“ç³»

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªStarï¼â­**

*Built with â¤ï¸ by the Greatest Works Team*

</div>